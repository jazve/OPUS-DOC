# å®æ–½è·¯çº¿å›¾ä¸ç¤ºä¾‹

## ğŸ¯ æ€»ä½“å®æ–½ç­–ç•¥

### å®æ–½åŸåˆ™
- **æ¸è¿›å¼å¼€å‘**ï¼šåˆ†é˜¶æ®µå®æ–½ï¼Œæ¯é˜¶æ®µéƒ½èƒ½ç‹¬ç«‹äº¤ä»˜ä»·å€¼
- **MVPä¼˜å…ˆ**ï¼šä¼˜å…ˆæ„å»ºæœ€å°å¯è¡Œäº§å“ï¼Œå¿«é€ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½
- **ç”¨æˆ·é©±åŠ¨**ï¼šä»¥ç”¨æˆ·éœ€æ±‚ä¸ºå¯¼å‘ï¼ŒæŒç»­è¿­ä»£æ”¹è¿›
- **æŠ€æœ¯ç¨³å¥**ï¼šç¡®ä¿æŠ€æœ¯æ¶æ„çš„å¯æ‰©å±•æ€§å’Œç¨³å®šæ€§

### å®æ–½æ—¶é—´çº¿
```mermaid
gantt
    title OPUSæ™ºèƒ½ä½“äº§å“å®æ–½è·¯çº¿å›¾
    dateFormat  YYYY-MM-DD
    section é˜¶æ®µä¸€ï¼šMVPåŸºç¡€
    éœ€æ±‚åˆ†æå’ŒæŠ€æœ¯è°ƒç ”    :done, a1, 2024-01-01, 2024-01-15
    æ ¸å¿ƒæ¶æ„è®¾è®¡         :done, a2, 2024-01-16, 2024-01-31
    OPUSè§£æå™¨å¼€å‘       :active, a3, 2024-02-01, 2024-02-28
    åŸºç¡€ä»£ç ç”Ÿæˆå™¨       :a4, 2024-03-01, 2024-03-31
    
    section é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½
    æ™ºèƒ½ä½“ç®¡ç†ç³»ç»Ÿ       :b1, 2024-04-01, 2024-04-30
    è¿è¡Œæ—¶å¼•æ“å¼€å‘       :b2, 2024-05-01, 2024-05-31
    Webæ§åˆ¶å°åŸºç¡€ç‰ˆ      :b3, 2024-06-01, 2024-06-30
    APIç½‘å…³å’Œè®¤è¯        :b4, 2024-07-01, 2024-07-31
    
    section é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½
    å¯è§†åŒ–æ„å»ºå™¨         :c1, 2024-08-01, 2024-08-31
    æ¨¡æ¿å¸‚åœºå¼€å‘         :c2, 2024-09-01, 2024-09-30
    éƒ¨ç½²ç®¡ç†ç³»ç»Ÿ         :c3, 2024-10-01, 2024-10-31
    ç›‘æ§åˆ†æå¹³å°         :c4, 2024-11-01, 2024-11-30
    
    section é˜¶æ®µå››ï¼šä¼ä¸šåŠŸèƒ½
    åä½œå¹³å°å¼€å‘         :d1, 2024-12-01, 2024-12-31
    ç§»åŠ¨ç«¯åº”ç”¨           :d2, 2025-01-01, 2025-01-31
    ä¼ä¸šçº§éƒ¨ç½²æ–¹æ¡ˆ       :d3, 2025-02-01, 2025-02-28
    AIå¢å¼ºåŠŸèƒ½           :d4, 2025-03-01, 2025-03-31
```

## ğŸš€ é˜¶æ®µä¸€ï¼šMVPåŸºç¡€ç‰ˆæœ¬

### ç›®æ ‡ä¸èŒƒå›´
**ç›®æ ‡**ï¼šæ„å»ºèƒ½å¤Ÿå°†OPUSæç¤ºè¯è½¬æ¢ä¸ºå¯æ‰§è¡Œä»£ç çš„åŸºç¡€ç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- OPUSè¯­æ³•è§£æå™¨
- åŸºç¡€ä»£ç ç”Ÿæˆå™¨
- ç®€å•çš„è¿è¡Œæ—¶ç¯å¢ƒ
- å‘½ä»¤è¡Œå·¥å…·

### æŠ€æœ¯å®ç°ç¤ºä¾‹

#### 1. OPUSè§£æå™¨MVP
```python
# opus_parser_mvp.py
import re
import json
from typing import Dict, Any, List
from dataclasses import dataclass

@dataclass
class OpusComponent:
    type: str
    content: str
    raw_text: str

class OpusParserMVP:
    """OPUSè§£æå™¨MVPç‰ˆæœ¬"""
    
    def __init__(self):
        self.component_patterns = {
            'identity': r'<identity>(.*?)</identity>',
            'architecture': r'<architecture>(.*?)</architecture>',
            'memory': r'<Memory>(.*?)</Memory>',
            'formats': r'<formats>(.*?)</formats>',
            'workflow': r'<workflow>(.*?)</workflow>',
            'constraints': r'<constraints>(.*?)</constraints>'
        }
    
    def parse(self, opus_content: str) -> Dict[str, OpusComponent]:
        """è§£æOPUSå†…å®¹"""
        components = {}
        
        for component_type, pattern in self.component_patterns.items():
            match = re.search(pattern, opus_content, re.DOTALL | re.IGNORECASE)
            if match:
                components[component_type] = OpusComponent(
                    type=component_type,
                    content=match.group(1).strip(),
                    raw_text=match.group(0)
                )
        
        return components
    
    def extract_functions(self, workflow_content: str) -> List[Dict[str, Any]]:
        """æå–å·¥ä½œæµå‡½æ•°"""
        function_pattern = r'FN\s+(\w+)\((.*?)\):\s*BEGIN(.*?)END'
        functions = []
        
        for match in re.finditer(function_pattern, workflow_content, re.DOTALL):
            functions.append({
                'name': match.group(1),
                'parameters': match.group(2).strip(),
                'body': match.group(3).strip()
            })
        
        return functions
    
    def extract_formats(self, formats_content: str) -> Dict[str, str]:
        """æå–æ ¼å¼å®šä¹‰"""
        format_pattern = r'\[Format\.(\w+)\]\s*=\s*(.*?)(?=\[Format\.|$)'
        formats = {}
        
        for match in re.finditer(format_pattern, formats_content, re.DOTALL):
            formats[match.group(1)] = match.group(2).strip()
        
        return formats

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    parser = OpusParserMVP()
    
    with open("sample_agent.opus", "r", encoding="utf-8") as f:
        opus_content = f.read()
    
    components = parser.parse(opus_content)
    print(f"è§£æå‡º {len(components)} ä¸ªç»„ä»¶")
    
    for comp_type, component in components.items():
        print(f"\n{comp_type.upper()}:")
        print(component.content[:200] + "...")
```

#### 2. åŸºç¡€ä»£ç ç”Ÿæˆå™¨
```python
# code_generator_mvp.py
from jinja2 import Template
from typing import Dict, Any
import os

class CodeGeneratorMVP:
    """åŸºç¡€ä»£ç ç”Ÿæˆå™¨"""
    
    def __init__(self):
        self.templates = self._load_templates()
    
    def _load_templates(self) -> Dict[str, Template]:
        """åŠ è½½ä»£ç æ¨¡æ¿"""
        agent_template = """
# -*- coding: utf-8 -*-
\"\"\"
Generated Agent: {{ agent_name }}
Created by OPUS Code Generator MVP
\"\"\"

import json
from typing import Dict, Any, Optional
from datetime import datetime

class {{ agent_class_name }}:
    \"\"\"{{ agent_description }}\"\"\"
    
    def __init__(self):
        self.identity = {{ identity | tojson }}
        self.memory = {}
        self.formats = {{ formats | tojson }}
        
    def process_request(self, user_input: str, context: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        \"\"\"å¤„ç†ç”¨æˆ·è¯·æ±‚\"\"\"
        try:
            # åŸºç¡€è¯·æ±‚å¤„ç†é€»è¾‘
            response = self._execute_workflow(user_input, context or {})
            
            # æ ¼å¼åŒ–å“åº”
            formatted_response = self._format_response(response)
            
            return {
                "success": True,
                "response": formatted_response,
                "timestamp": datetime.utcnow().isoformat()
            }
        except Exception as e:
            return {
                "success": False,
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def _execute_workflow(self, user_input: str, context: Dict[str, Any]) -> str:
        \"\"\"æ‰§è¡Œå·¥ä½œæµ\"\"\"
        # ç®€åŒ–çš„å·¥ä½œæµæ‰§è¡Œ
        {% for function in functions %}
        # {{ function.name }}: {{ function.parameters }}
        {% endfor %}
        
        return f"å¤„ç†äº†è¯·æ±‚: {user_input}"
    
    def _format_response(self, response: str) -> str:
        \"\"\"æ ¼å¼åŒ–å“åº”\"\"\"
        # ä½¿ç”¨é¢„å®šä¹‰æ ¼å¼
        if "é»˜è®¤" in self.formats:
            return self.formats["é»˜è®¤"].replace("{{content}}", response)
        return response
    
    {% for function in functions %}
    def {{ function.name | lower }}(self{% if function.parameters %}, {{ function.parameters }}{% endif %}):
        \"\"\"{{ function.name }}å‡½æ•°\"\"\"
        # TODO: å®ç°{{ function.name }}é€»è¾‘
        # {{ function.body | replace("\\n", "\\n        # ") }}
        pass
    {% endfor %}

if __name__ == "__main__":
    agent = {{ agent_class_name }}()
    
    # æµ‹è¯•è¿è¡Œ
    test_input = "ä½ å¥½ï¼Œæˆ‘éœ€è¦å¸®åŠ©"
    result = agent.process_request(test_input)
    print(json.dumps(result, ensure_ascii=False, indent=2))
"""
        
        return {
            "agent": Template(agent_template)
        }
    
    def generate_agent_code(self, components: Dict[str, Any]) -> str:
        """ç”Ÿæˆæ™ºèƒ½ä½“ä»£ç """
        # æå–ç»„ä»¶ä¿¡æ¯
        identity = self._parse_identity(components.get('identity', ''))
        functions = self._parse_functions(components.get('workflow', ''))
        formats = self._parse_formats(components.get('formats', ''))
        
        # ç”Ÿæˆç±»å
        agent_name = identity.get('name', 'UnknownAgent')
        agent_class_name = self._to_class_name(agent_name)
        
        # æ¸²æŸ“æ¨¡æ¿
        template = self.templates['agent']
        code = template.render(
            agent_name=agent_name,
            agent_class_name=agent_class_name,
            agent_description=identity.get('description', 'æ™ºèƒ½ä½“'),
            identity=identity,
            functions=functions,
            formats=formats
        )
        
        return code
    
    def _parse_identity(self, identity_content: str) -> Dict[str, Any]:
        """è§£æèº«ä»½ä¿¡æ¯"""
        # ç®€åŒ–çš„èº«ä»½è§£æ
        lines = identity_content.split('\\n')
        identity = {
            'name': 'Agent',
            'description': 'æ™ºèƒ½ä½“',
            'capabilities': []
        }
        
        for line in lines:
            if 'ä½ æ˜¯' in line:
                identity['name'] = line.split('ä½ æ˜¯')[1].split('ï¼Œ')[0].strip()
            elif 'æ ¸å¿ƒèƒ½åŠ›' in line:
                identity['description'] = line.strip()
        
        return identity
    
    def _parse_functions(self, workflow_content: str) -> List[Dict[str, Any]]:
        """è§£æå‡½æ•°å®šä¹‰"""
        # ä½¿ç”¨ä¹‹å‰è§£æå™¨çš„å‡½æ•°æå–é€»è¾‘
        parser = OpusParserMVP()
        return parser.extract_functions(workflow_content)
    
    def _parse_formats(self, formats_content: str) -> Dict[str, str]:
        """è§£ææ ¼å¼å®šä¹‰"""
        parser = OpusParserMVP()
        return parser.extract_formats(formats_content)
    
    def _to_class_name(self, name: str) -> str:
        """è½¬æ¢ä¸ºç±»åæ ¼å¼"""
        # ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œè½¬æ¢ä¸ºé©¼å³°å‘½å
        clean_name = ''.join(c for c in name if c.isalnum() or c in '_ ')
        words = clean_name.split()
        return ''.join(word.capitalize() for word in words) + 'Agent'

# CLIå·¥å…·
if __name__ == "__main__":
    import sys
    
    if len(sys.argv) != 3:
        print("ç”¨æ³•: python code_generator_mvp.py <opus_file> <output_file>")
        sys.exit(1)
    
    opus_file = sys.argv[1]
    output_file = sys.argv[2]
    
    # è§£æOPUSæ–‡ä»¶
    parser = OpusParserMVP()
    with open(opus_file, 'r', encoding='utf-8') as f:
        opus_content = f.read()
    
    components = parser.parse(opus_content)
    
    # ç”Ÿæˆä»£ç 
    generator = CodeGeneratorMVP()
    code = generator.generate_agent_code(components)
    
    # ä¿å­˜ä»£ç 
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(code)
    
    print(f"ä»£ç å·²ç”Ÿæˆåˆ°: {output_file}")
```

#### 3. ç®€å•è¿è¡Œæ—¶ç¯å¢ƒ
```python
# agent_runtime_mvp.py
import json
import logging
from typing import Dict, Any, Optional
from datetime import datetime

class AgentRuntimeMVP:
    """ç®€å•çš„æ™ºèƒ½ä½“è¿è¡Œæ—¶ç¯å¢ƒ"""
    
    def __init__(self, agent_module):
        self.agent = agent_module
        self.session_data = {}
        self.logger = self._setup_logger()
    
    def _setup_logger(self):
        """è®¾ç½®æ—¥å¿—"""
        logger = logging.getLogger('agent_runtime')
        logger.setLevel(logging.INFO)
        
        handler = logging.StreamHandler()
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        handler.setFormatter(formatter)
        logger.addHandler(handler)
        
        return logger
    
    def start_session(self, session_id: str) -> Dict[str, Any]:
        """å¯åŠ¨ä¼šè¯"""
        self.session_data[session_id] = {
            'created_at': datetime.utcnow().isoformat(),
            'messages': [],
            'context': {}
        }
        
        self.logger.info(f"ä¼šè¯ {session_id} å·²å¯åŠ¨")
        
        return {
            'session_id': session_id,
            'status': 'active',
            'message': 'ä¼šè¯å·²å¯åŠ¨'
        }
    
    def process_message(self, session_id: str, message: str) -> Dict[str, Any]:
        """å¤„ç†æ¶ˆæ¯"""
        if session_id not in self.session_data:
            return {
                'error': f'ä¼šè¯ {session_id} ä¸å­˜åœ¨',
                'timestamp': datetime.utcnow().isoformat()
            }
        
        session = self.session_data[session_id]
        
        try:
            # è®°å½•ç”¨æˆ·æ¶ˆæ¯
            session['messages'].append({
                'type': 'user',
                'content': message,
                'timestamp': datetime.utcnow().isoformat()
            })
            
            # è°ƒç”¨æ™ºèƒ½ä½“å¤„ç†
            result = self.agent.process_request(message, session['context'])
            
            # è®°å½•æ™ºèƒ½ä½“å“åº”
            session['messages'].append({
                'type': 'agent',
                'content': result.get('response', ''),
                'timestamp': datetime.utcnow().isoformat()
            })
            
            self.logger.info(f"ä¼šè¯ {session_id} å¤„ç†æ¶ˆæ¯: {message[:50]}...")
            
            return result
            
        except Exception as e:
            self.logger.error(f"å¤„ç†æ¶ˆæ¯æ—¶å‡ºé”™: {e}")
            return {
                'success': False,
                'error': str(e),
                'timestamp': datetime.utcnow().isoformat()
            }
    
    def get_session_history(self, session_id: str) -> Dict[str, Any]:
        """è·å–ä¼šè¯å†å²"""
        if session_id not in self.session_data:
            return {'error': f'ä¼šè¯ {session_id} ä¸å­˜åœ¨'}
        
        return self.session_data[session_id]
    
    def end_session(self, session_id: str) -> Dict[str, Any]:
        """ç»“æŸä¼šè¯"""
        if session_id in self.session_data:
            del self.session_data[session_id]
            self.logger.info(f"ä¼šè¯ {session_id} å·²ç»“æŸ")
            return {'message': 'ä¼šè¯å·²ç»“æŸ'}
        
        return {'error': f'ä¼šè¯ {session_id} ä¸å­˜åœ¨'}

# å‘½ä»¤è¡Œäº¤äº’å·¥å…·
class CLIInterface:
    """å‘½ä»¤è¡Œäº¤äº’ç•Œé¢"""
    
    def __init__(self, agent_file: str):
        # åŠ¨æ€å¯¼å…¥ç”Ÿæˆçš„æ™ºèƒ½ä½“
        import importlib.util
        spec = importlib.util.spec_from_file_location("agent_module", agent_file)
        agent_module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(agent_module)
        
        # è·å–æ™ºèƒ½ä½“ç±»
        agent_class = None
        for attr_name in dir(agent_module):
            attr = getattr(agent_module, attr_name)
            if isinstance(attr, type) and attr_name.endswith('Agent'):
                agent_class = attr
                break
        
        if not agent_class:
            raise ValueError("æœªæ‰¾åˆ°æ™ºèƒ½ä½“ç±»")
        
        self.agent = agent_class()
        self.runtime = AgentRuntimeMVP(self.agent)
        self.session_id = f"cli_{datetime.utcnow().strftime('%Y%m%d_%H%M%S')}"
    
    def run(self):
        """è¿è¡ŒCLIç•Œé¢"""
        print("ğŸ¤– OPUSæ™ºèƒ½ä½“ CLI - MVPç‰ˆæœ¬")
        print("=" * 50)
        print("è¾“å…¥ '/help' æŸ¥çœ‹å¸®åŠ©ï¼Œè¾“å…¥ '/quit' é€€å‡º")
        print()
        
        # å¯åŠ¨ä¼šè¯
        self.runtime.start_session(self.session_id)
        
        while True:
            try:
                user_input = input("ğŸ‘¤ ç”¨æˆ·: ").strip()
                
                if user_input == '/quit':
                    break
                elif user_input == '/help':
                    self._show_help()
                    continue
                elif user_input == '/history':
                    self._show_history()
                    continue
                elif user_input == '':
                    continue
                
                # å¤„ç†ç”¨æˆ·è¾“å…¥
                result = self.runtime.process_message(self.session_id, user_input)
                
                if result.get('success', True):
                    print(f"ğŸ¤– æ™ºèƒ½ä½“: {result.get('response', 'æ— å“åº”')}")
                else:
                    print(f"âŒ é”™è¯¯: {result.get('error', 'æœªçŸ¥é”™è¯¯')}")
                
                print()
                
            except KeyboardInterrupt:
                print("\\nç¨‹åºè¢«ç”¨æˆ·ä¸­æ–­")
                break
            except Exception as e:
                print(f"âŒ ç³»ç»Ÿé”™è¯¯: {e}")
        
        # ç»“æŸä¼šè¯
        self.runtime.end_session(self.session_id)
        print("ğŸ‘‹ å†è§ï¼")
    
    def _show_help(self):
        """æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"""
        print("ğŸ“– å¸®åŠ©ä¿¡æ¯:")
        print("  /help    - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯")
        print("  /history - æ˜¾ç¤ºå¯¹è¯å†å²")
        print("  /quit    - é€€å‡ºç¨‹åº")
        print()
    
    def _show_history(self):
        """æ˜¾ç¤ºå¯¹è¯å†å²"""
        history = self.runtime.get_session_history(self.session_id)
        messages = history.get('messages', [])
        
        print("ğŸ“œ å¯¹è¯å†å²:")
        for i, msg in enumerate(messages, 1):
            icon = "ğŸ‘¤" if msg['type'] == 'user' else "ğŸ¤–"
            print(f"  {i}. {icon} {msg['content']}")
        print()

if __name__ == "__main__":
    import sys
    
    if len(sys.argv) != 2:
        print("ç”¨æ³•: python agent_runtime_mvp.py <agent_file.py>")
        sys.exit(1)
    
    agent_file = sys.argv[1]
    
    try:
        cli = CLIInterface(agent_file)
        cli.run()
    except Exception as e:
        print(f"å¯åŠ¨å¤±è´¥: {e}")
```

#### 4. ç®€å•Webç•Œé¢
```python
# web_interface_mvp.py
from flask import Flask, render_template, request, jsonify, session
import uuid
from datetime import datetime
import importlib.util
import os

app = Flask(__name__)
app.secret_key = 'your-secret-key-here'

class WebInterfaceMVP:
    """ç®€å•Webç•Œé¢"""
    
    def __init__(self):
        self.runtimes = {}  # å­˜å‚¨ä¸åŒç”¨æˆ·çš„è¿è¡Œæ—¶
    
    def load_agent(self, agent_file: str):
        """åŠ è½½æ™ºèƒ½ä½“"""
        spec = importlib.util.spec_from_file_location("agent_module", agent_file)
        agent_module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(agent_module)
        
        # è·å–æ™ºèƒ½ä½“ç±»
        for attr_name in dir(agent_module):
            attr = getattr(agent_module, attr_name)
            if isinstance(attr, type) and attr_name.endswith('Agent'):
                return attr()
        
        raise ValueError("æœªæ‰¾åˆ°æ™ºèƒ½ä½“ç±»")
    
    def get_or_create_runtime(self, session_id: str):
        """è·å–æˆ–åˆ›å»ºè¿è¡Œæ—¶"""
        if session_id not in self.runtimes:
            agent_file = os.environ.get('AGENT_FILE', 'generated_agent.py')
            agent = self.load_agent(agent_file)
            self.runtimes[session_id] = AgentRuntimeMVP(agent)
            self.runtimes[session_id].start_session(session_id)
        
        return self.runtimes[session_id]

web_interface = WebInterfaceMVP()

@app.route('/')
def index():
    """ä¸»é¡µ"""
    if 'session_id' not in session:
        session['session_id'] = str(uuid.uuid4())
    
    return render_template('chat.html')

@app.route('/api/chat', methods=['POST'])
def chat():
    """èŠå¤©API"""
    data = request.get_json()
    message = data.get('message', '')
    
    if not message:
        return jsonify({'error': 'æ¶ˆæ¯ä¸èƒ½ä¸ºç©º'}), 400
    
    session_id = session.get('session_id')
    if not session_id:
        return jsonify({'error': 'ä¼šè¯æ— æ•ˆ'}), 400
    
    try:
        runtime = web_interface.get_or_create_runtime(session_id)
        result = runtime.process_message(session_id, message)
        return jsonify(result)
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/history')
def history():
    """è·å–å†å²"""
    session_id = session.get('session_id')
    if not session_id:
        return jsonify({'error': 'ä¼šè¯æ— æ•ˆ'}), 400
    
    try:
        runtime = web_interface.get_or_create_runtime(session_id)
        history = runtime.get_session_history(session_id)
        return jsonify(history)
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# HTMLæ¨¡æ¿
HTML_TEMPLATE = '''
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPUSæ™ºèƒ½ä½“ - MVPç‰ˆæœ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }
        .message.user {
            justify-content: flex-end;
        }
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        .message.user .message-content {
            background: #007AFF;
            color: white;
        }
        .message.agent .message-content {
            background: #f1f3f5;
            color: #333;
        }
        .input-container {
            padding: 20px;
            display: flex;
            gap: 10px;
        }
        .input-container input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
        }
        .input-container button {
            padding: 12px 24px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
        }
        .input-container button:hover {
            background: #0056CC;
        }
        .input-container button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– OPUSæ™ºèƒ½ä½“</h1>
            <p>MVPæ¼”ç¤ºç‰ˆæœ¬</p>
        </div>
        <div id="chatContainer" class="chat-container">
            <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        <div class="input-container">
            <input type="text" id="messageInput" placeholder="è¾“å…¥æ‚¨çš„æ¶ˆæ¯..." onkeypress="handleKeyPress(event)">
            <button id="sendButton" onclick="sendMessage()">å‘é€</button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addMessage('user', message);
            messageInput.value = '';
            
            // ç¦ç”¨å‘é€æŒ‰é’®
            sendButton.disabled = true;
            sendButton.textContent = 'å‘é€ä¸­...';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();

                if (data.success !== false) {
                    addMessage('agent', data.response || 'æ— å“åº”');
                } else {
                    addMessage('agent', `é”™è¯¯: ${data.error}`);
                }
            } catch (error) {
                addMessage('agent', `ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                // æ¢å¤å‘é€æŒ‰é’®
                sendButton.disabled = false;
                sendButton.textContent = 'å‘é€';
                messageInput.focus();
            }
        }

        // å¤„ç†å›è½¦é”®
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåèšç„¦è¾“å…¥æ¡†
        window.addEventListener('load', () => {
            messageInput.focus();
            addMessage('agent', 'ä½ å¥½ï¼æˆ‘æ˜¯OPUSæ™ºèƒ½ä½“ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ');
        });
    </script>
</body>
</html>
'''

# åˆ›å»ºæ¨¡æ¿ç›®å½•å’Œæ–‡ä»¶
if not os.path.exists('templates'):
    os.makedirs('templates')

with open('templates/chat.html', 'w', encoding='utf-8') as f:
    f.write(HTML_TEMPLATE)

if __name__ == '__main__':
    import sys
    
    if len(sys.argv) > 1:
        os.environ['AGENT_FILE'] = sys.argv[1]
    
    print("ğŸš€ å¯åŠ¨OPUSæ™ºèƒ½ä½“Webç•Œé¢...")
    print("è®¿é—® http://localhost:5000 å¼€å§‹ä½¿ç”¨")
    
    app.run(debug=True, host='0.0.0.0', port=5000)
```

### MVPéƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# deploy_mvp.sh

echo "ğŸš€ éƒ¨ç½²OPUSæ™ºèƒ½ä½“MVPç‰ˆæœ¬"

# 1. åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p opus-mvp
cd opus-mvp

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install flask jinja2

# 4. å¤åˆ¶ä»£ç æ–‡ä»¶
# (å‡è®¾ä»£ç æ–‡ä»¶å·²ç»å­˜åœ¨)

# 5. åˆ›å»ºç¤ºä¾‹OPUSæ–‡ä»¶
cat > sample_agent.opus << 'EOF'
<identity>
ä½ æ˜¯ä»£ç å®¡æŸ¥åŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©å¼€å‘è€…è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥å’Œæ”¹è¿›å»ºè®®ã€‚
æ ¸å¿ƒèƒ½åŠ›ï¼šä»£ç åˆ†æã€è´¨é‡è¯„ä¼°ã€æ”¹è¿›å»ºè®®ã€æœ€ä½³å®è·µæ¨è
è¯­æ°”é£æ ¼ï¼šä¸“ä¸šä¸¥è°¨ã€å»ºè®¾æ€§ã€å‹å¥½æŒ‡å¯¼
</identity>

<architecture>
ä¸“ä¸šçŸ¥è¯†ï¼š[è½¯ä»¶å·¥ç¨‹,ä»£ç è´¨é‡,è®¾è®¡æ¨¡å¼,æœ€ä½³å®è·µ]
æ ¸å¿ƒæŠ€èƒ½ï¼š[ä»£ç åˆ†æ,é—®é¢˜è¯†åˆ«,æ”¹è¿›å»ºè®®,æ–‡æ¡£ç”Ÿæˆ]
æ¨ç†å¼•æ“ï¼š[é€»è¾‘åˆ†æ,æ¨¡å¼è¯†åˆ«,è´¨é‡è¯„ä¼°]
</architecture>

<Memory>
è®°å¿†ç³»ç»Ÿï¼šä»£ç å®¡æŸ¥å†å²å’Œæ¨¡å¼åº“
æ“ä½œï¼š[Memory.Store,Memory.Retrieve,Memory.Analyze]
</Memory>

<formats>
[Format.åˆ†æ] = ğŸ“‹ **ä»£ç åˆ†æç»“æœ**
- ğŸ¯ **è´¨é‡è¯„åˆ†**ï¼š{{quality_score}}/10
- âš ï¸ **é—®é¢˜æ•°é‡**ï¼š{{issue_count}}
- ğŸ’¡ **æ”¹è¿›å»ºè®®**ï¼š{{suggestions}}

[Format.å»ºè®®] = ğŸ’¡ **æ”¹è¿›å»ºè®®**
{{suggestion_details}}
</formats>

<workflow>
FN å®¡æŸ¥ä»£ç (code_content):
BEGIN
  åˆ†æä»£ç ç»“æ„å’Œè´¨é‡
  è¯†åˆ«æ½œåœ¨é—®é¢˜
  ç”Ÿæˆæ”¹è¿›å»ºè®®
  è¾“å‡ºæ ¼å¼åŒ–ç»“æœ
END

FN æä¾›å»ºè®®(issue_type):
BEGIN
  æ ¹æ®é—®é¢˜ç±»å‹ç»™å‡ºå…·ä½“å»ºè®®
  åŒ…å«ä»£ç ç¤ºä¾‹
  è§£é‡Šæ”¹è¿›ç†ç”±
END
</workflow>

<constraints>
**è¡Œä¸ºçº¦æŸ**ï¼š
- ä¿æŒä¸“ä¸šå’Œå»ºè®¾æ€§çš„å®¡æŸ¥æ€åº¦
- æä¾›å…·ä½“å¯è¡Œçš„æ”¹è¿›å»ºè®®
- å…³æ³¨ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µ

**æŠ€æœ¯çº¦æŸ**ï¼š
- æ”¯æŒä¸»æµç¼–ç¨‹è¯­è¨€
- éµå¾ªè¡Œä¸šæ ‡å‡†å’Œè§„èŒƒ
</constraints>
EOF

# 6. ç”Ÿæˆæ™ºèƒ½ä½“ä»£ç 
echo "ğŸ“ ç”Ÿæˆæ™ºèƒ½ä½“ä»£ç ..."
python code_generator_mvp.py sample_agent.opus generated_agent.py

# 7. æµ‹è¯•CLIç•Œé¢
echo "ğŸ§ª æµ‹è¯•CLIç•Œé¢..."
echo "ä½ å¥½ï¼Œå¸®æˆ‘å®¡æŸ¥ä¸€æ®µPythonä»£ç " | python agent_runtime_mvp.py generated_agent.py

# 8. å¯åŠ¨Webç•Œé¢
echo "ğŸŒ å¯åŠ¨Webç•Œé¢..."
python web_interface_mvp.py generated_agent.py &

echo "âœ… MVPéƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ Webç•Œé¢: http://localhost:5000"
echo "ğŸ’» CLIæµ‹è¯•: python agent_runtime_mvp.py generated_agent.py"
```

## ğŸ”„ é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘

### ç›®æ ‡ä¸èŒƒå›´
**ç›®æ ‡**ï¼šæ„å»ºå®Œæ•´çš„æ™ºèƒ½ä½“ç®¡ç†å’Œè¿è¡Œç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ™ºèƒ½ä½“ç®¡ç†Webç•Œé¢
- å¤šç”¨æˆ·æ”¯æŒå’Œæƒé™ç®¡ç†
- RESTful API
- æ•°æ®æŒä¹…åŒ–
- åŸºç¡€ç›‘æ§

### å®ç°ç¤ºä¾‹

#### 1. Webç®¡ç†ç•Œé¢æ¶æ„
```typescript
// frontend/src/types/agent.ts
export interface Agent {
  id: string;
  name: string;
  description: string;
  opusCode: string;
  ownerId: string;
  status: 'draft' | 'active' | 'inactive';
  createdAt: string;
  updatedAt: string;
  metrics?: AgentMetrics;
}

export interface AgentMetrics {
  requestCount: number;
  avgResponseTime: number;
  errorRate: number;
  lastActiveAt: string;
}

// frontend/src/components/AgentManager.tsx
import React, { useState, useEffect } from 'react';
import { Agent } from '../types/agent';
import { agentService } from '../services/agentService';

export const AgentManager: React.FC = () => {
  const [agents, setAgents] = useState<Agent[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedAgent, setSelectedAgent] = useState<Agent | null>(null);

  useEffect(() => {
    loadAgents();
  }, []);

  const loadAgents = async () => {
    try {
      const agentList = await agentService.listAgents();
      setAgents(agentList);
    } catch (error) {
      console.error('åŠ è½½æ™ºèƒ½ä½“å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleCreateAgent = async (agentData: Partial<Agent>) => {
    try {
      const newAgent = await agentService.createAgent(agentData);
      setAgents([...agents, newAgent]);
    } catch (error) {
      console.error('åˆ›å»ºæ™ºèƒ½ä½“å¤±è´¥:', error);
    }
  };

  const handleDeleteAgent = async (agentId: string) => {
    try {
      await agentService.deleteAgent(agentId);
      setAgents(agents.filter(agent => agent.id !== agentId));
    } catch (error) {
      console.error('åˆ é™¤æ™ºèƒ½ä½“å¤±è´¥:', error);
    }
  };

  if (loading) {
    return <div className="loading">åŠ è½½ä¸­...</div>;
  }

  return (
    <div className="agent-manager">
      <div className="agent-list">
        <h2>æ™ºèƒ½ä½“åˆ—è¡¨</h2>
        <button 
          className="create-btn"
          onClick={() => setSelectedAgent({} as Agent)}
        >
          åˆ›å»ºæ–°æ™ºèƒ½ä½“
        </button>
        
        {agents.map(agent => (
          <div key={agent.id} className="agent-card">
            <h3>{agent.name}</h3>
            <p>{agent.description}</p>
            <div className="agent-status">
              çŠ¶æ€: {agent.status}
            </div>
            <div className="agent-actions">
              <button onClick={() => setSelectedAgent(agent)}>ç¼–è¾‘</button>
              <button onClick={() => handleDeleteAgent(agent.id)}>åˆ é™¤</button>
            </div>
          </div>
        ))}
      </div>
      
      {selectedAgent && (
        <AgentEditor
          agent={selectedAgent}
          onSave={handleCreateAgent}
          onCancel={() => setSelectedAgent(null)}
        />
      )}
    </div>
  );
};
```

#### 2. åç«¯APIæœåŠ¡
```python
# backend/app/main.py
from fastapi import FastAPI, Depends, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from sqlalchemy.orm import Session
from typing import List

from .database import get_db
from .models import Agent as AgentModel
from .schemas import Agent, AgentCreate, AgentUpdate
from .services.agent_service import AgentService
from .auth import get_current_user

app = FastAPI(title="OPUS Agent Platform", version="2.0.0")

# CORSé…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # å‰ç«¯åœ°å€
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

agent_service = AgentService()

@app.get("/api/agents", response_model=List[Agent])
async def list_agents(
    skip: int = 0,
    limit: int = 100,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """è·å–æ™ºèƒ½ä½“åˆ—è¡¨"""
    agents = agent_service.get_user_agents(db, current_user.id, skip, limit)
    return agents

@app.post("/api/agents", response_model=Agent)
async def create_agent(
    agent: AgentCreate,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """åˆ›å»ºæ™ºèƒ½ä½“"""
    return agent_service.create_agent(db, agent, current_user.id)

@app.get("/api/agents/{agent_id}", response_model=Agent)
async def get_agent(
    agent_id: str,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """è·å–æ™ºèƒ½ä½“è¯¦æƒ…"""
    agent = agent_service.get_agent(db, agent_id)
    if not agent or agent.owner_id != current_user.id:
        raise HTTPException(status_code=404, detail="æ™ºèƒ½ä½“ä¸å­˜åœ¨")
    return agent

@app.put("/api/agents/{agent_id}", response_model=Agent)
async def update_agent(
    agent_id: str,
    agent_update: AgentUpdate,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """æ›´æ–°æ™ºèƒ½ä½“"""
    agent = agent_service.get_agent(db, agent_id)
    if not agent or agent.owner_id != current_user.id:
        raise HTTPException(status_code=404, detail="æ™ºèƒ½ä½“ä¸å­˜åœ¨")
    
    return agent_service.update_agent(db, agent_id, agent_update)

@app.delete("/api/agents/{agent_id}")
async def delete_agent(
    agent_id: str,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """åˆ é™¤æ™ºèƒ½ä½“"""
    agent = agent_service.get_agent(db, agent_id)
    if not agent or agent.owner_id != current_user.id:
        raise HTTPException(status_code=404, detail="æ™ºèƒ½ä½“ä¸å­˜åœ¨")
    
    agent_service.delete_agent(db, agent_id)
    return {"message": "æ™ºèƒ½ä½“å·²åˆ é™¤"}

@app.post("/api/agents/{agent_id}/chat")
async def chat_with_agent(
    agent_id: str,
    message: dict,
    db: Session = Depends(get_db),
    current_user = Depends(get_current_user)
):
    """ä¸æ™ºèƒ½ä½“å¯¹è¯"""
    agent = agent_service.get_agent(db, agent_id)
    if not agent:
        raise HTTPException(status_code=404, detail="æ™ºèƒ½ä½“ä¸å­˜åœ¨")
    
    # æ£€æŸ¥æƒé™ï¼ˆæ‰€æœ‰è€…æˆ–æœ‰æƒé™çš„ç”¨æˆ·ï¼‰
    if not agent_service.can_access_agent(agent, current_user.id):
        raise HTTPException(status_code=403, detail="æ— æƒé™è®¿é—®æ­¤æ™ºèƒ½ä½“")
    
    # å¤„ç†å¯¹è¯
    response = await agent_service.process_chat(agent_id, message, current_user.id)
    return response
```

#### 3. æ•°æ®æ¨¡å‹è®¾è®¡
```python
# backend/app/models.py
from sqlalchemy import Column, String, Text, DateTime, Integer, ForeignKey, Enum
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship
from datetime import datetime
import enum

Base = declarative_base()

class AgentStatus(enum.Enum):
    DRAFT = "draft"
    ACTIVE = "active"
    INACTIVE = "inactive"

class Agent(Base):
    __tablename__ = "agents"
    
    id = Column(String, primary_key=True)
    name = Column(String(100), nullable=False)
    description = Column(Text)
    opus_code = Column(Text, nullable=False)
    owner_id = Column(String, ForeignKey("users.id"), nullable=False)
    status = Column(Enum(AgentStatus), default=AgentStatus.DRAFT)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # å…³ç³»
    owner = relationship("User", back_populates="agents")
    conversations = relationship("Conversation", back_populates="agent")
    metrics = relationship("AgentMetrics", back_populates="agent", uselist=False)

class User(Base):
    __tablename__ = "users"
    
    id = Column(String, primary_key=True)
    username = Column(String(50), unique=True, nullable=False)
    email = Column(String(100), unique=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    agents = relationship("Agent", back_populates="owner")

class Conversation(Base):
    __tablename__ = "conversations"
    
    id = Column(String, primary_key=True)
    agent_id = Column(String, ForeignKey("agents.id"), nullable=False)
    user_id = Column(String, ForeignKey("users.id"), nullable=False)
    session_id = Column(String, nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    agent = relationship("Agent", back_populates="conversations")
    messages = relationship("Message", back_populates="conversation")

class Message(Base):
    __tablename__ = "messages"
    
    id = Column(String, primary_key=True)
    conversation_id = Column(String, ForeignKey("conversations.id"), nullable=False)
    role = Column(String(10), nullable=False)  # 'user' or 'agent'
    content = Column(Text, nullable=False)
    timestamp = Column(DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    conversation = relationship("Conversation", back_populates="messages")

class AgentMetrics(Base):
    __tablename__ = "agent_metrics"
    
    id = Column(String, primary_key=True)
    agent_id = Column(String, ForeignKey("agents.id"), nullable=False)
    request_count = Column(Integer, default=0)
    avg_response_time = Column(Integer, default=0)  # æ¯«ç§’
    error_rate = Column(Integer, default=0)  # ç™¾åˆ†æ¯”
    last_active_at = Column(DateTime)
    
    # å…³ç³»
    agent = relationship("Agent", back_populates="metrics")
```

### é˜¶æ®µäºŒéƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# deploy_stage2.sh

echo "ğŸš€ éƒ¨ç½²OPUSæ™ºèƒ½ä½“å¹³å° - é˜¶æ®µäºŒ"

# 1. æ£€æŸ¥ç¯å¢ƒ
command -v docker >/dev/null 2>&1 || { echo "éœ€è¦å®‰è£…Docker"; exit 1; }
command -v docker-compose >/dev/null 2>&1 || { echo "éœ€è¦å®‰è£…Docker Compose"; exit 1; }
command -v node >/dev/null 2>&1 || { echo "éœ€è¦å®‰è£…Node.js"; exit 1; }

# 2. åˆ›å»ºé¡¹ç›®ç»“æ„
mkdir -p opus-platform/{backend,frontend,database,docker}
cd opus-platform

# 3. åˆ›å»ºDocker Composeé…ç½®
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  database:
    image: postgres:14
    environment:
      POSTGRES_DB: opus_platform
      POSTGRES_USER: opus_user
      POSTGRES_PASSWORD: opus_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7
    ports:
      - "6379:6379"

  backend:
    build: ./backend
    environment:
      DATABASE_URL: postgresql://opus_user:opus_password@database:5432/opus_platform
      REDIS_URL: redis://redis:6379/0
      SECRET_KEY: your-secret-key-here
    ports:
      - "8000:8000"
    depends_on:
      - database
      - redis
    volumes:
      - ./backend:/app

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      REACT_APP_API_URL: http://localhost:8000
    volumes:
      - ./frontend:/app
    depends_on:
      - backend

volumes:
  postgres_data:
EOF

# 4. åˆ›å»ºåç«¯Dockerfile
cat > backend/Dockerfile << 'EOF'
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
EOF

# 5. åˆ›å»ºå‰ç«¯Dockerfile
cat > frontend/Dockerfile << 'EOF'
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

CMD ["npm", "start"]
EOF

# 6. åˆ›å»ºåç«¯ä¾èµ–æ–‡ä»¶
cat > backend/requirements.txt << 'EOF'
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.12.1
redis==5.0.1
python-jose==3.3.0
passlib==1.7.4
python-multipart==0.0.6
pydantic==2.5.0
jinja2==3.1.2
EOF

# 7. åˆå§‹åŒ–å‰ç«¯é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ï¼‰
if [ ! -f "frontend/package.json" ]; then
    cd frontend
    npx create-react-app . --template typescript
    npm install axios @types/axios
    cd ..
fi

# 8. å¯åŠ¨æœåŠ¡
echo "ğŸ³ å¯åŠ¨DockeræœåŠ¡..."
docker-compose up -d database redis

echo "â³ ç­‰å¾…æ•°æ®åº“å¯åŠ¨..."
sleep 10

echo "ğŸ—„ï¸ åˆå§‹åŒ–æ•°æ®åº“..."
docker-compose run --rm backend alembic upgrade head

echo "ğŸš€ å¯åŠ¨æ‰€æœ‰æœåŠ¡..."
docker-compose up -d

echo "âœ… é˜¶æ®µäºŒéƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ å‰ç«¯ç•Œé¢: http://localhost:3000"
echo "ğŸ”§ åç«¯API: http://localhost:8000"
echo "ğŸ“– APIæ–‡æ¡£: http://localhost:8000/docs"
echo ""
echo "ğŸ“Š æœåŠ¡çŠ¶æ€:"
docker-compose ps
EOF
```

## ğŸ“ˆ é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½

### å¯è§†åŒ–æ„å»ºå™¨å®ç°
```typescript
// frontend/src/components/VisualBuilder/OpusBuilder.tsx
import React, { useState, useCallback } from 'react';
import { DndProvider } from 'react-dnd';
import { HTML5Backend } from 'react-dnd-html5-backend';
import { ComponentPalette } from './ComponentPalette';
import { BuilderCanvas } from './BuilderCanvas';
import { PropertyPanel } from './PropertyPanel';
import { CodePreview } from './CodePreview';

interface OpusComponent {
  id: string;
  type: 'identity' | 'architecture' | 'memory' | 'formats' | 'workflow' | 'constraints';
  position: { x: number; y: number };
  properties: Record<string, any>;
  connections: string[];
}

export const OpusBuilder: React.FC = () => {
  const [components, setComponents] = useState<OpusComponent[]>([]);
  const [selectedComponent, setSelectedComponent] = useState<OpusComponent | null>(null);
  const [generatedCode, setGeneratedCode] = useState<string>('');

  const handleAddComponent = useCallback((componentType: string, position: { x: number; y: number }) => {
    const newComponent: OpusComponent = {
      id: `${componentType}_${Date.now()}`,
      type: componentType as any,
      position,
      properties: getDefaultProperties(componentType),
      connections: []
    };
    
    setComponents(prev => [...prev, newComponent]);
  }, []);

  const handleUpdateComponent = useCallback((componentId: string, updates: Partial<OpusComponent>) => {
    setComponents(prev => prev.map(comp => 
      comp.id === componentId ? { ...comp, ...updates } : comp
    ));
  }, []);

  const handleGenerateCode = useCallback(async () => {
    try {
      const response = await fetch('/api/generate-opus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ components })
      });
      
      const data = await response.json();
      setGeneratedCode(data.opusCode);
    } catch (error) {
      console.error('ç”Ÿæˆä»£ç å¤±è´¥:', error);
    }
  }, [components]);

  return (
    <DndProvider backend={HTML5Backend}>
      <div className="opus-builder">
        <div className="builder-layout">
          <div className="left-panel">
            <ComponentPalette />
          </div>
          
          <div className="center-panel">
            <BuilderCanvas
              components={components}
              onAddComponent={handleAddComponent}
              onSelectComponent={setSelectedComponent}
              onUpdateComponent={handleUpdateComponent}
            />
          </div>
          
          <div className="right-panel">
            <PropertyPanel
              selectedComponent={selectedComponent}
              onUpdateComponent={handleUpdateComponent}
            />
            
            <CodePreview
              code={generatedCode}
              onGenerate={handleGenerateCode}
            />
          </div>
        </div>
      </div>
    </DndProvider>
  );
};

function getDefaultProperties(componentType: string): Record<string, any> {
  const defaults = {
    identity: {
      name: 'æ–°æ™ºèƒ½ä½“',
      description: 'æ™ºèƒ½ä½“æè¿°',
      capabilities: [],
      tone: 'professional'
    },
    architecture: {
      knowledge: [],
      skills: [],
      tools: [],
      rag: false
    },
    memory: {
      structure: 'hierarchical',
      operations: ['store', 'retrieve'],
      persistence: true
    },
    formats: {
      templates: []
    },
    workflow: {
      functions: []
    },
    constraints: {
      behavioral: [],
      technical: [],
      content: []
    }
  };
  
  return defaults[componentType] || {};
}
```

### æ¨¡æ¿å¸‚åœºå®ç°
```python
# backend/app/services/marketplace_service.py
from typing import List, Optional
from sqlalchemy.orm import Session
from sqlalchemy import and_, or_, func
from ..models import AgentTemplate, User, TemplateReview
from ..schemas import TemplateCreate, TemplateSearch, TemplateStats

class MarketplaceService:
    """æ¨¡æ¿å¸‚åœºæœåŠ¡"""
    
    def __init__(self):
        self.search_engine = TemplateSearchEngine()
        self.recommendation_engine = RecommendationEngine()
    
    def publish_template(self, db: Session, template_data: TemplateCreate, user_id: str) -> AgentTemplate:
        """å‘å¸ƒæ¨¡æ¿"""
        # 1. å®‰å…¨æ£€æŸ¥
        security_result = self.security_scanner.scan_template(template_data.opus_code)
        if not security_result.is_safe:
            raise SecurityException("æ¨¡æ¿åŒ…å«å®‰å…¨é£é™©")
        
        # 2. è´¨é‡æ£€æŸ¥
        quality_score = self.quality_analyzer.analyze(template_data.opus_code)
        if quality_score < 0.7:
            raise QualityException("æ¨¡æ¿è´¨é‡ä¸ç¬¦åˆå‘å¸ƒæ ‡å‡†")
        
        # 3. åˆ›å»ºæ¨¡æ¿
        template = AgentTemplate(
            id=generate_id(),
            name=template_data.name,
            description=template_data.description,
            category=template_data.category,
            opus_code=template_data.opus_code,
            creator_id=user_id,
            price=template_data.price,
            license=template_data.license,
            quality_score=quality_score,
            status="published"
        )
        
        db.add(template)
        db.commit()
        
        # 4. å»ºç«‹æœç´¢ç´¢å¼•
        self.search_engine.index_template(template)
        
        return template
    
    def search_templates(self, db: Session, search_query: TemplateSearch) -> List[AgentTemplate]:
        """æœç´¢æ¨¡æ¿"""
        query = db.query(AgentTemplate).filter(
            AgentTemplate.status == "published"
        )
        
        # æ–‡æœ¬æœç´¢
        if search_query.text:
            search_terms = search_query.text.split()
            text_filter = or_(*[
                or_(
                    AgentTemplate.name.ilike(f"%{term}%"),
                    AgentTemplate.description.ilike(f"%{term}%"),
                    AgentTemplate.tags.contains([term])
                ) for term in search_terms
            ])
            query = query.filter(text_filter)
        
        # åˆ†ç±»è¿‡æ»¤
        if search_query.category:
            query = query.filter(AgentTemplate.category == search_query.category)
        
        # ä»·æ ¼èŒƒå›´
        if search_query.min_price is not None:
            query = query.filter(AgentTemplate.price >= search_query.min_price)
        if search_query.max_price is not None:
            query = query.filter(AgentTemplate.price <= search_query.max_price)
        
        # è¯„åˆ†è¿‡æ»¤
        if search_query.min_rating:
            query = query.filter(AgentTemplate.rating >= search_query.min_rating)
        
        # æ’åº
        if search_query.sort_by == "popularity":
            query = query.order_by(AgentTemplate.downloads.desc())
        elif search_query.sort_by == "rating":
            query = query.order_by(AgentTemplate.rating.desc())
        elif search_query.sort_by == "newest":
            query = query.order_by(AgentTemplate.created_at.desc())
        elif search_query.sort_by == "price_low":
            query = query.order_by(AgentTemplate.price.asc())
        elif search_query.sort_by == "price_high":
            query = query.order_by(AgentTemplate.price.desc())
        
        # åˆ†é¡µ
        offset = (search_query.page - 1) * search_query.page_size
        return query.offset(offset).limit(search_query.page_size).all()
    
    def get_recommendations(self, db: Session, user_id: str) -> List[AgentTemplate]:
        """è·å–ä¸ªæ€§åŒ–æ¨è"""
        user_profile = self.build_user_profile(db, user_id)
        return self.recommendation_engine.recommend(db, user_profile)
    
    def download_template(self, db: Session, template_id: str, user_id: str) -> AgentTemplate:
        """ä¸‹è½½æ¨¡æ¿"""
        template = db.query(AgentTemplate).filter(AgentTemplate.id == template_id).first()
        if not template:
            raise NotFoundException("æ¨¡æ¿ä¸å­˜åœ¨")
        
        # æ£€æŸ¥è´­ä¹°æƒé™ï¼ˆå¦‚æœæ˜¯ä»˜è´¹æ¨¡æ¿ï¼‰
        if template.price > 0:
            purchase = self.check_purchase(db, template_id, user_id)
            if not purchase:
                raise PermissionException("éœ€è¦è´­ä¹°æ­¤æ¨¡æ¿")
        
        # å¢åŠ ä¸‹è½½æ¬¡æ•°
        template.downloads += 1
        db.commit()
        
        # è®°å½•ä¸‹è½½å†å²
        self.record_download(db, template_id, user_id)
        
        return template
    
    def rate_template(self, db: Session, template_id: str, user_id: str, rating: int, review: str = None) -> None:
        """è¯„ä»·æ¨¡æ¿"""
        # æ£€æŸ¥æ˜¯å¦å·²è¯„ä»·
        existing_review = db.query(TemplateReview).filter(
            and_(
                TemplateReview.template_id == template_id,
                TemplateReview.user_id == user_id
            )
        ).first()
        
        if existing_review:
            # æ›´æ–°è¯„ä»·
            existing_review.rating = rating
            existing_review.review = review
            existing_review.updated_at = datetime.utcnow()
        else:
            # æ–°å¢è¯„ä»·
            new_review = TemplateReview(
                id=generate_id(),
                template_id=template_id,
                user_id=user_id,
                rating=rating,
                review=review
            )
            db.add(new_review)
        
        db.commit()
        
        # æ›´æ–°æ¨¡æ¿å¹³å‡è¯„åˆ†
        self.update_template_rating(db, template_id)
    
    def get_template_stats(self, db: Session, template_id: str) -> TemplateStats:
        """è·å–æ¨¡æ¿ç»Ÿè®¡"""
        template = db.query(AgentTemplate).filter(AgentTemplate.id == template_id).first()
        if not template:
            raise NotFoundException("æ¨¡æ¿ä¸å­˜åœ¨")
        
        # è®¡ç®—ç»Ÿè®¡æ•°æ®
        review_stats = db.query(
            func.count(TemplateReview.id).label('review_count'),
            func.avg(TemplateReview.rating).label('avg_rating'),
            func.max(TemplateReview.created_at).label('latest_review')
        ).filter(TemplateReview.template_id == template_id).first()
        
        return TemplateStats(
            template_id=template_id,
            downloads=template.downloads,
            review_count=review_stats.review_count or 0,
            average_rating=float(review_stats.avg_rating or 0),
            latest_review_date=review_stats.latest_review
        )
```

## ğŸš€ é˜¶æ®µå››ï¼šä¼ä¸šçº§åŠŸèƒ½

### åä½œå¹³å°å®ç°
```python
# backend/app/services/collaboration_service.py
from typing import List, Optional
from sqlalchemy.orm import Session
from ..models import Workspace, WorkspaceMember, Agent, ShareLink
from ..schemas import WorkspaceCreate, SharingConfig

class CollaborationService:
    """åä½œæœåŠ¡"""
    
    def __init__(self):
        self.version_control = VersionControlService()
        self.notification_service = NotificationService()
    
    def create_workspace(self, db: Session, workspace_data: WorkspaceCreate, owner_id: str) -> Workspace:
        """åˆ›å»ºå·¥ä½œç©ºé—´"""
        workspace = Workspace(
            id=generate_id(),
            name=workspace_data.name,
            description=workspace_data.description,
            owner_id=owner_id,
            settings=workspace_data.settings
        )
        
        db.add(workspace)
        
        # æ·»åŠ æ‰€æœ‰è€…ä¸ºç®¡ç†å‘˜
        owner_member = WorkspaceMember(
            workspace_id=workspace.id,
            user_id=owner_id,
            role="admin",
            permissions=["read", "write", "manage", "share"]
        )
        db.add(owner_member)
        
        db.commit()
        
        # åˆå§‹åŒ–ç‰ˆæœ¬æ§åˆ¶
        self.version_control.init_workspace_repo(workspace.id)
        
        return workspace
    
    def invite_member(self, db: Session, workspace_id: str, inviter_id: str, email: str, role: str) -> None:
        """é‚€è¯·æˆå‘˜"""
        # æ£€æŸ¥é‚€è¯·æƒé™
        if not self.has_permission(db, workspace_id, inviter_id, "manage"):
            raise PermissionException("æ— æƒé™é‚€è¯·æˆå‘˜")
        
        # å‘é€é‚€è¯·é‚®ä»¶
        invitation_token = generate_invitation_token()
        self.notification_service.send_workspace_invitation(
            email=email,
            workspace_name=self.get_workspace_name(db, workspace_id),
            invitation_url=f"/workspace/join/{invitation_token}",
            inviter_name=self.get_user_name(db, inviter_id)
        )
        
        # å­˜å‚¨é‚€è¯·è®°å½•
        self.store_invitation(db, workspace_id, email, role, invitation_token)
    
    def share_agent(self, db: Session, agent_id: str, user_id: str, config: SharingConfig) -> ShareLink:
        """åˆ†äº«æ™ºèƒ½ä½“"""
        agent = db.query(Agent).filter(Agent.id == agent_id).first()
        if not agent:
            raise NotFoundException("æ™ºèƒ½ä½“ä¸å­˜åœ¨")
        
        # æ£€æŸ¥åˆ†äº«æƒé™
        if not self.can_share_agent(db, agent_id, user_id):
            raise PermissionException("æ— æƒé™åˆ†äº«æ­¤æ™ºèƒ½ä½“")
        
        # åˆ›å»ºåˆ†äº«é“¾æ¥
        share_link = ShareLink(
            id=generate_id(),
            agent_id=agent_id,
            creator_id=user_id,
            access_token=generate_access_token(),
            permissions=config.permissions,
            expires_at=config.expires_at,
            max_uses=config.max_uses,
            uses_count=0
        )
        
        db.add(share_link)
        db.commit()
        
        return share_link
    
    def fork_agent(self, db: Session, agent_id: str, user_id: str, workspace_id: Optional[str] = None) -> Agent:
        """å¤åˆ¶æ™ºèƒ½ä½“"""
        original_agent = db.query(Agent).filter(Agent.id == agent_id).first()
        if not original_agent:
            raise NotFoundException("æ™ºèƒ½ä½“ä¸å­˜åœ¨")
        
        # æ£€æŸ¥è®¿é—®æƒé™
        if not self.can_access_agent(db, agent_id, user_id):
            raise PermissionException("æ— æƒé™è®¿é—®æ­¤æ™ºèƒ½ä½“")
        
        # åˆ›å»ºå¤åˆ¶
        forked_agent = Agent(
            id=generate_id(),
            name=f"{original_agent.name} (Fork)",
            description=original_agent.description,
            opus_code=original_agent.opus_code,
            owner_id=user_id,
            workspace_id=workspace_id,
            parent_id=agent_id,
            status="draft"
        )
        
        db.add(forked_agent)
        db.commit()
        
        # åˆ›å»ºç‰ˆæœ¬æ§åˆ¶åˆ†æ”¯
        self.version_control.create_fork(original_agent.id, forked_agent.id)
        
        return forked_agent
    
    def sync_changes(self, db: Session, source_agent_id: str, target_agent_id: str, user_id: str) -> None:
        """åŒæ­¥å˜æ›´"""
        # æ£€æŸ¥æƒé™
        if not self.can_write_agent(db, target_agent_id, user_id):
            raise PermissionException("æ— æƒé™ä¿®æ”¹ç›®æ ‡æ™ºèƒ½ä½“")
        
        # è·å–å˜æ›´
        changes = self.version_control.get_changes(source_agent_id, target_agent_id)
        
        if not changes:
            return
        
        # åº”ç”¨å˜æ›´
        target_agent = db.query(Agent).filter(Agent.id == target_agent_id).first()
        merged_code = self.version_control.merge_changes(target_agent.opus_code, changes)
        
        target_agent.opus_code = merged_code
        target_agent.updated_at = datetime.utcnow()
        
        db.commit()
        
        # è®°å½•åŒæ­¥å†å²
        self.record_sync(db, source_agent_id, target_agent_id, user_id)
```

### ç§»åŠ¨ç«¯æ ¸å¿ƒåŠŸèƒ½
```typescript
// mobile/src/services/AgentService.ts
import AsyncStorage from '@react-native-async-storage/async-storage';
import { Agent, ChatMessage, OfflineCapability } from '../types';

export class MobileAgentService {
  private apiClient: APIClient;
  private offlineManager: OfflineManager;
  
  constructor() {
    this.apiClient = new APIClient();
    this.offlineManager = new OfflineManager();
  }
  
  async syncAgents(): Promise<Agent[]> {
    try {
      // åœ¨çº¿è·å–æœ€æ–°æ™ºèƒ½ä½“åˆ—è¡¨
      const onlineAgents = await this.apiClient.getAgents();
      
      // ç¼“å­˜åˆ°æœ¬åœ°
      await AsyncStorage.setItem('cached_agents', JSON.stringify(onlineAgents));
      
      return onlineAgents;
    } catch (error) {
      // ç¦»çº¿æ¨¡å¼ï¼šä»ç¼“å­˜è·å–
      const cachedAgents = await AsyncStorage.getItem('cached_agents');
      return cachedAgents ? JSON.parse(cachedAgents) : [];
    }
  }
  
  async chatWithAgent(agentId: string, message: string): Promise<ChatMessage> {
    try {
      // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
      const isOnline = await this.checkNetworkStatus();
      
      if (isOnline) {
        // åœ¨çº¿æ¨¡å¼
        return await this.apiClient.chat(agentId, message);
      } else {
        // ç¦»çº¿æ¨¡å¼
        return await this.offlineManager.processOfflineChat(agentId, message);
      }
    } catch (error) {
      // é™çº§åˆ°ç¦»çº¿å¤„ç†
      return await this.offlineManager.processOfflineChat(agentId, message);
    }
  }
  
  async enableOfflineAgent(agentId: string): Promise<void> {
    const agent = await this.apiClient.getAgent(agentId);
    
    // ä¸‹è½½æ™ºèƒ½ä½“æ•°æ®
    const agentData = {
      ...agent,
      offlineModel: await this.downloadOfflineModel(agent),
      offlineKnowledge: await this.downloadOfflineKnowledge(agent)
    };
    
    // ä¿å­˜åˆ°æœ¬åœ°
    await this.offlineManager.storeOfflineAgent(agentData);
  }
  
  async startVoiceChat(agentId: string): Promise<void> {
    const audioRecorder = new AudioRecorder();
    
    // å¼€å§‹å½•éŸ³
    const audioStream = await audioRecorder.start();
    
    // è¯­éŸ³è½¬æ–‡å­—
    const transcription = await this.speechToText(audioStream);
    
    // å‘é€æ¶ˆæ¯
    const response = await this.chatWithAgent(agentId, transcription);
    
    // æ–‡å­—è½¬è¯­éŸ³
    await this.textToSpeech(response.content);
  }
  
  async getLocationContext(): Promise<LocationContext> {
    const location = await Geolocation.getCurrentPosition();
    const placeInfo = await this.placesAPI.getPlaceInfo(location);
    
    return {
      coordinates: location,
      placeName: placeInfo.name,
      placeType: placeInfo.type,
      nearbyPOIs: placeInfo.nearbyPOIs
    };
  }
}

// mobile/src/components/ChatScreen.tsx
import React, { useState, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, FlatList } from 'react-native';
import { ChatMessage } from '../types';
import { MobileAgentService } from '../services/AgentService';

interface ChatScreenProps {
  agentId: string;
}

export const ChatScreen: React.FC<ChatScreenProps> = ({ agentId }) => {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [inputText, setInputText] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isVoiceMode, setIsVoiceMode] = useState(false);
  
  const agentService = new MobileAgentService();
  
  const sendMessage = async (text: string) => {
    if (!text.trim()) return;
    
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      role: 'user',
      content: text,
      timestamp: new Date()
    };
    
    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsLoading(true);
    
    try {
      const response = await agentService.chatWithAgent(agentId, text);
      setMessages(prev => [...prev, response]);
    } catch (error) {
      console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
    } finally {
      setIsLoading(false);
    }
  };
  
  const startVoiceChat = async () => {
    setIsVoiceMode(true);
    try {
      await agentService.startVoiceChat(agentId);
    } catch (error) {
      console.error('è¯­éŸ³èŠå¤©å¤±è´¥:', error);
    } finally {
      setIsVoiceMode(false);
    }
  };
  
  const renderMessage = ({ item }: { item: ChatMessage }) => (
    <View style={[
      styles.messageContainer,
      item.role === 'user' ? styles.userMessage : styles.agentMessage
    ]}>
      <Text style={styles.messageText}>{item.content}</Text>
      <Text style={styles.messageTime}>
        {item.timestamp.toLocaleTimeString()}
      </Text>
    </View>
  );
  
  return (
    <View style={styles.container}>
      <FlatList
        data={messages}
        renderItem={renderMessage}
        keyExtractor={item => item.id}
        style={styles.messagesList}
      />
      
      <View style={styles.inputContainer}>
        <TextInput
          style={styles.textInput}
          value={inputText}
          onChangeText={setInputText}
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          multiline
        />
        
        <TouchableOpacity
          style={styles.voiceButton}
          onPress={startVoiceChat}
          disabled={isVoiceMode}
        >
          <Text style={styles.buttonText}>
            {isVoiceMode ? 'ğŸ¤' : 'ğŸ™ï¸'}
          </Text>
        </TouchableOpacity>
        
        <TouchableOpacity
          style={styles.sendButton}
          onPress={() => sendMessage(inputText)}
          disabled={isLoading}
        >
          <Text style={styles.buttonText}>å‘é€</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};
```

## ğŸ“Š æœ€ç»ˆå®Œæ•´ç¤ºä¾‹

### ç«¯åˆ°ç«¯æ¼”ç¤ºæµç¨‹
```bash
#!/bin/bash
# complete_demo.sh - å®Œæ•´æ¼”ç¤ºè„šæœ¬

echo "ğŸ¯ OPUSæ™ºèƒ½ä½“å¹³å°å®Œæ•´æ¼”ç¤º"
echo "=================================="

# 1. åˆ›å»ºç¤ºä¾‹OPUSæ™ºèƒ½ä½“
cat > demo_agent.opus << 'EOF'
<identity>
ä½ æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹å°æ™ºï¼Œä¸“é—¨ä¸ºç”µå•†å¹³å°æä¾›24/7å®¢æˆ·æœåŠ¡æ”¯æŒã€‚
æ ¸å¿ƒèƒ½åŠ›ï¼šè®¢å•æŸ¥è¯¢ã€é€€æ¢è´§å¤„ç†ã€å•†å“æ¨èã€é—®é¢˜è§£ç­”
è¯­æ°”é£æ ¼ï¼šå‹å¥½çƒ­æƒ…ã€ä¸“ä¸šé«˜æ•ˆã€è€å¿ƒç»†è‡´
</identity>

<architecture>
ä¸“ä¸šçŸ¥è¯†ï¼š[ç”µå•†ä¸šåŠ¡æµç¨‹,å®¢æˆ·æœåŠ¡æ ‡å‡†,å•†å“ä¿¡æ¯ç®¡ç†,è®¢å•å¤„ç†ç³»ç»Ÿ]
æ ¸å¿ƒæŠ€èƒ½ï¼š[è®¢å•çŠ¶æ€æŸ¥è¯¢,é€€æ¢è´§æ”¿ç­–è§£é‡Š,å•†å“ç‰¹æ€§ä»‹ç»,é—®é¢˜åˆ†ç±»å¤„ç†]
æ¨ç†å¼•æ“ï¼š[æƒ…æ„Ÿåˆ†æ,æ„å›¾è¯†åˆ«,é—®é¢˜ä¼˜å…ˆçº§åˆ¤æ–­]
å¤–éƒ¨å·¥å…·ï¼š[è®¢å•ç³»ç»ŸAPI,å•†å“æ•°æ®åº“,ç‰©æµæŸ¥è¯¢API,æ”¯ä»˜ç³»ç»ŸAPI]
RAGæ£€ç´¢ï¼š[å•†å“çŸ¥è¯†åº“,FAQæ•°æ®åº“,æ”¿ç­–æ–‡æ¡£åº“]
</architecture>

<Memory>
è®°å¿†æ¶æ„ï¼šå®¢æˆ·äº¤äº’å†å²å’Œåå¥½åˆ†æ
åŠ¨æ€æ“ä½œï¼š
[Memory.Store("customer_profile/{user_id}", customer_data)]
[Memory.Retrieve("order_history/{user_id}")]
[Memory.Update("preferences/{user_id}", preference_data)]
[Memory.Locate("similar_issues", context)]
</Memory>

<formats>
[Format.è®¢å•æŸ¥è¯¢] = ğŸ“¦ **è®¢å•ä¿¡æ¯**
- ğŸ” **è®¢å•å·**ï¼š{{order_id}}
- ğŸ“… **ä¸‹å•æ—¶é—´**ï¼š{{order_date}}
- ğŸ’° **è®¢å•é‡‘é¢**ï¼š{{amount}}
- ğŸšš **ç‰©æµçŠ¶æ€**ï¼š{{shipping_status}}
- ğŸ“ **å½“å‰ä½ç½®**ï¼š{{current_location}}

[Format.å•†å“æ¨è] = ğŸ›ï¸ **ä¸ºæ‚¨æ¨è**
- ğŸ“± **å•†å“åç§°**ï¼š{{product_name}}
- ğŸ’µ **ä»·æ ¼**ï¼š{{price}}
- â­ **è¯„åˆ†**ï¼š{{rating}}
- ğŸ¯ **æ¨èç†ç”±**ï¼š{{reason}}

[Format.é—®é¢˜è§£ç­”] = ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**
{{solution_steps}}

å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©ï¼Œè¯·è”ç³»äººå·¥å®¢æœï¼š400-123-4567
</formats>

<workflow>
FN å¤„ç†å®¢æˆ·å’¨è¯¢(user_input):
BEGIN
  æ„å›¾åˆ†æ = åˆ†æç”¨æˆ·æ„å›¾(user_input)
  
  IF æ„å›¾åˆ†æ.type == "è®¢å•æŸ¥è¯¢" THEN:
    æ‰§è¡Œ æŸ¥è¯¢è®¢å•ä¿¡æ¯(æ„å›¾åˆ†æ.order_id)
  ELSEIF æ„å›¾åˆ†æ.type == "å•†å“å’¨è¯¢" THEN:
    æ‰§è¡Œ æä¾›å•†å“ä¿¡æ¯(æ„å›¾åˆ†æ.product_id)
  ELSEIF æ„å›¾åˆ†æ.type == "é€€æ¢è´§" THEN:
    æ‰§è¡Œ å¤„ç†é€€æ¢è´§ç”³è¯·(æ„å›¾åˆ†æ.details)
  ELSEIF æ„å›¾åˆ†æ.type == "æŠ•è¯‰å»ºè®®" THEN:
    æ‰§è¡Œ å¤„ç†æŠ•è¯‰å»ºè®®(æ„å›¾åˆ†æ.content)
  ELSE:
    æ‰§è¡Œ é€šç”¨é—®é¢˜è§£ç­”(user_input)
  END
END

FN æŸ¥è¯¢è®¢å•ä¿¡æ¯(order_id):
BEGIN
  è®¢å•æ•°æ® = è°ƒç”¨è®¢å•API(order_id)
  ç‰©æµä¿¡æ¯ = è°ƒç”¨ç‰©æµAPI(è®¢å•æ•°æ®.tracking_number)
  
  æ›´æ–°å®¢æˆ·è®°å¿†(å®¢æˆ·ID, è®¢å•æ•°æ®)
  
  è¾“å‡º[Format.è®¢å•æŸ¥è¯¢]
END

FN æä¾›å•†å“ä¿¡æ¯(product_query):
BEGIN
  å•†å“åˆ—è¡¨ = RAGæ£€ç´¢å•†å“ä¿¡æ¯(product_query)
  ä¸ªäººåå¥½ = Memory.Retrieve("preferences/" + å®¢æˆ·ID)
  
  æ¨èå•†å“ = ä¸ªæ€§åŒ–æ’åº(å•†å“åˆ—è¡¨, ä¸ªäººåå¥½)
  
  è¾“å‡º[Format.å•†å“æ¨è]
END

FN å¤„ç†é€€æ¢è´§ç”³è¯·(ç”³è¯·è¯¦æƒ…):
BEGIN
  è®¢å•éªŒè¯ = éªŒè¯è®¢å•æœ‰æ•ˆæ€§(ç”³è¯·è¯¦æƒ….è®¢å•å·)
  æ”¿ç­–æ£€æŸ¥ = æ£€æŸ¥é€€æ¢è´§æ”¿ç­–(ç”³è¯·è¯¦æƒ…)
  
  IF æ”¿ç­–æ£€æŸ¥.å¯ä»¥é€€æ¢ THEN:
    åˆ›å»ºé€€æ¢è´§ç”³è¯·(ç”³è¯·è¯¦æƒ…)
    å‘é€ç¡®è®¤é€šçŸ¥(å®¢æˆ·è”ç³»æ–¹å¼)
    è¾“å‡º "âœ… é€€æ¢è´§ç”³è¯·å·²æäº¤ï¼Œé¢„è®¡3-5ä¸ªå·¥ä½œæ—¥å¤„ç†å®Œæˆ"
  ELSE:
    è¾“å‡º "âŒ " + æ”¿ç­–æ£€æŸ¥.æ‹’ç»åŸå› 
  END
END
</workflow>

<constraints>
**æœåŠ¡æ ‡å‡†**ï¼š
- å“åº”æ—¶é—´ä¸è¶…è¿‡3ç§’
- å‡†ç¡®ç‡è¾¾åˆ°95%ä»¥ä¸Š
- å®¢æˆ·æ»¡æ„åº¦ä¿æŒåœ¨4.5æ˜Ÿä»¥ä¸Š

**è¡Œä¸ºçº¦æŸ**ï¼š
- ä¿æŒå‹å¥½ä¸“ä¸šçš„æœåŠ¡æ€åº¦
- å‡†ç¡®ç†è§£å®¢æˆ·éœ€æ±‚
- åŠæ—¶æä¾›æœ‰æ•ˆè§£å†³æ–¹æ¡ˆ
- é€‚æ—¶æ¨èç›¸å…³å•†å“å’ŒæœåŠ¡

**æŠ€æœ¯çº¦æŸ**ï¼š
- ä¸¥æ ¼ä¿æŠ¤å®¢æˆ·éšç§æ•°æ®
- ç¡®ä¿è®¢å•ä¿¡æ¯å‡†ç¡®æ€§
- éµå¾ªå…¬å¸é€€æ¢è´§æ”¿ç­–
- è®°å½•æ‰€æœ‰æœåŠ¡äº¤äº’
</constraints>
EOF

echo "âœ… åˆ›å»ºç¤ºä¾‹OPUSæ™ºèƒ½ä½“æ–‡ä»¶"

# 2. ç”Ÿæˆä»£ç å·¥ç¨‹
echo "ğŸ”§ ç”Ÿæˆä»£ç å·¥ç¨‹..."
mkdir -p demo_output
python3 opus_converter.py demo_agent.opus --output-dir demo_output --framework fastapi

echo "âœ… ä»£ç å·¥ç¨‹ç”Ÿæˆå®Œæˆ"

# 3. æ„å»ºå’Œéƒ¨ç½²
echo "ğŸ³ æ„å»ºDockeré•œåƒ..."
cd demo_output
docker build -t opus-demo-agent:latest .

echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker run -d \
  --name opus-demo \
  -p 8080:8000 \
  -e AGENT_NAME="æ™ºèƒ½å®¢æœå°æ™º" \
  -e LOG_LEVEL="INFO" \
  opus-demo-agent:latest

echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# 4. æµ‹è¯•API
echo "ğŸ§ª æµ‹è¯•APIæ¥å£..."

# å¥åº·æ£€æŸ¥
echo "å¥åº·æ£€æŸ¥:"
curl -s http://localhost:8080/health | jq

# æ™ºèƒ½ä½“ä¿¡æ¯
echo -e "\næ™ºèƒ½ä½“ä¿¡æ¯:"
curl -s http://localhost:8080/api/agent/info | jq

# å¯¹è¯æµ‹è¯•
echo -e "\nå¯¹è¯æµ‹è¯•:"
curl -s -X POST http://localhost:8080/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œæˆ‘æƒ³æŸ¥è¯¢è®¢å•ä¿¡æ¯"}' | jq

curl -s -X POST http://localhost:8080/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "æ¨èä¸€äº›æ‰‹æœºç»™æˆ‘"}' | jq

# 5. æ€§èƒ½æµ‹è¯•
echo -e "\nğŸ“Š æ€§èƒ½æµ‹è¯•..."
echo "å¹¶å‘æµ‹è¯• (10ä¸ªå¹¶å‘ç”¨æˆ·ï¼ŒæŒç»­30ç§’):"
ab -n 100 -c 10 -t 30 -T 'application/json' \
  -p <(echo '{"message": "å¸®æˆ‘æŸ¥è¯¢è®¢å•"}') \
  http://localhost:8080/api/chat

# 6. ç›‘æ§æ•°æ®
echo -e "\nğŸ“ˆ ç›‘æ§æ•°æ®:"
curl -s http://localhost:8080/api/metrics | jq

echo -e "\nâœ… æ¼”ç¤ºå®Œæˆï¼"
echo "ğŸŒ Webç•Œé¢: http://localhost:8080"
echo "ğŸ“– APIæ–‡æ¡£: http://localhost:8080/docs"
echo "ğŸ“Š ç›‘æ§é¢æ¿: http://localhost:8080/metrics"
echo ""
echo "ğŸ”§ ç®¡ç†å‘½ä»¤:"
echo "  åœæ­¢æœåŠ¡: docker stop opus-demo"
echo "  æŸ¥çœ‹æ—¥å¿—: docker logs opus-demo"
echo "  é‡å¯æœåŠ¡: docker restart opus-demo"
```

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"id": "1", "content": "Analyze existing OPUS documentation and architecture", "status": "completed", "priority": "high"}, {"id": "2", "content": "Design code generation architecture for OPUS-to-code conversion", "status": "completed", "priority": "high"}, {"id": "3", "content": "Create development framework specification", "status": "completed", "priority": "high"}, {"id": "4", "content": "Design intelligent agent product architecture", "status": "completed", "priority": "high"}, {"id": "5", "content": "Create implementation roadmap and examples", "status": "completed", "priority": "medium"}]